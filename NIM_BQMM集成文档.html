<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<style type="text/css">
.ef0,.f0 { color: #000000; } .eb0,.b0 { background-color: #000000; }
.ef1,.f1 { color: #AA0000; } .eb1,.b1 { background-color: #AA0000; }
.ef2,.f2 { color: #00AA00; } .eb2,.b2 { background-color: #00AA00; }
.ef3,.f3 { color: #AA5500; } .eb3,.b3 { background-color: #AA5500; }
.ef4,.f4 { color: #0000AA; } .eb4,.b4 { background-color: #0000AA; }
.ef5,.f5 { color: #AA00AA; } .eb5,.b5 { background-color: #AA00AA; }
.ef6,.f6 { color: #FF55FF; } .eb6,.b6 { background-color: #FF55FF; }
.ef7,.f7 { color: #AAAAAA; } .eb7,.b7 { background-color: #AAAAAA; }
.ef8, .f0 > .bold,.bold > .f0 { color: #555555; font-weight: normal; }
.ef9, .f1 > .bold,.bold > .f1 { color: #FF5555; font-weight: normal; }
.ef10,.f2 > .bold,.bold > .f2 { color: #55FF55; font-weight: normal; }
.ef11,.f3 > .bold,.bold > .f3 { color: #FFFF55; font-weight: normal; }
.ef12,.f4 > .bold,.bold > .f4 { color: #5555FF; font-weight: normal; }
.ef13,.f5 > .bold,.bold > .f5 { color: #FF55FF; font-weight: normal; }
.ef14,.f6 > .bold,.bold > .f6 { color: #55FFFF; font-weight: normal; }
.ef15,.f7 > .bold,.bold > .f7 { color: #FFFFFF; font-weight: normal; }
.eb8  { background-color: #555555; }
.eb9  { background-color: #FF5555; }
.eb10 { background-color: #55FF55; }
.eb11 { background-color: #FFFF55; }
.eb12 { background-color: #5555FF; }
.eb13 { background-color: #FF55FF; }
.eb14 { background-color: #55FFFF; }
.eb15 { background-color: #FFFFFF; }
.ef16 { color: #000000; } .eb16 { background-color: #000000; }
.ef17 { color: #00005f; } .eb17 { background-color: #00005f; }
.ef18 { color: #000087; } .eb18 { background-color: #000087; }
.ef19 { color: #0000af; } .eb19 { background-color: #0000af; }
.ef20 { color: #0000d7; } .eb20 { background-color: #0000d7; }
.ef21 { color: #0000ff; } .eb21 { background-color: #0000ff; }
.ef22 { color: #005f00; } .eb22 { background-color: #005f00; }
.ef23 { color: #005f5f; } .eb23 { background-color: #005f5f; }
.ef24 { color: #005f87; } .eb24 { background-color: #005f87; }
.ef25 { color: #005faf; } .eb25 { background-color: #005faf; }
.ef26 { color: #005fd7; } .eb26 { background-color: #005fd7; }
.ef27 { color: #005fff; } .eb27 { background-color: #005fff; }
.ef28 { color: #008700; } .eb28 { background-color: #008700; }
.ef29 { color: #00875f; } .eb29 { background-color: #00875f; }
.ef30 { color: #008787; } .eb30 { background-color: #008787; }
.ef31 { color: #0087af; } .eb31 { background-color: #0087af; }
.ef32 { color: #0087d7; } .eb32 { background-color: #0087d7; }
.ef33 { color: #0087ff; } .eb33 { background-color: #0087ff; }
.ef34 { color: #00af00; } .eb34 { background-color: #00af00; }
.ef35 { color: #00af5f; } .eb35 { background-color: #00af5f; }
.ef36 { color: #00af87; } .eb36 { background-color: #00af87; }
.ef37 { color: #00afaf; } .eb37 { background-color: #00afaf; }
.ef38 { color: #00afd7; } .eb38 { background-color: #00afd7; }
.ef39 { color: #00afff; } .eb39 { background-color: #00afff; }
.ef40 { color: #00d700; } .eb40 { background-color: #00d700; }
.ef41 { color: #00d75f; } .eb41 { background-color: #00d75f; }
.ef42 { color: #00d787; } .eb42 { background-color: #00d787; }
.ef43 { color: #00d7af; } .eb43 { background-color: #00d7af; }
.ef44 { color: #00d7d7; } .eb44 { background-color: #00d7d7; }
.ef45 { color: #00d7ff; } .eb45 { background-color: #00d7ff; }
.ef46 { color: #00ff00; } .eb46 { background-color: #00ff00; }
.ef47 { color: #00ff5f; } .eb47 { background-color: #00ff5f; }
.ef48 { color: #00ff87; } .eb48 { background-color: #00ff87; }
.ef49 { color: #00ffaf; } .eb49 { background-color: #00ffaf; }
.ef50 { color: #00ffd7; } .eb50 { background-color: #00ffd7; }
.ef51 { color: #00ffff; } .eb51 { background-color: #00ffff; }
.ef52 { color: #5f0000; } .eb52 { background-color: #5f0000; }
.ef53 { color: #5f005f; } .eb53 { background-color: #5f005f; }
.ef54 { color: #5f0087; } .eb54 { background-color: #5f0087; }
.ef55 { color: #5f00af; } .eb55 { background-color: #5f00af; }
.ef56 { color: #5f00d7; } .eb56 { background-color: #5f00d7; }
.ef57 { color: #5f00ff; } .eb57 { background-color: #5f00ff; }
.ef58 { color: #5f5f00; } .eb58 { background-color: #5f5f00; }
.ef59 { color: #5f5f5f; } .eb59 { background-color: #5f5f5f; }
.ef60 { color: #5f5f87; } .eb60 { background-color: #5f5f87; }
.ef61 { color: #5f5faf; } .eb61 { background-color: #5f5faf; }
.ef62 { color: #5f5fd7; } .eb62 { background-color: #5f5fd7; }
.ef63 { color: #5f5fff; } .eb63 { background-color: #5f5fff; }
.ef64 { color: #5f8700; } .eb64 { background-color: #5f8700; }
.ef65 { color: #5f875f; } .eb65 { background-color: #5f875f; }
.ef66 { color: #5f8787; } .eb66 { background-color: #5f8787; }
.ef67 { color: #5f87af; } .eb67 { background-color: #5f87af; }
.ef68 { color: #5f87d7; } .eb68 { background-color: #5f87d7; }
.ef69 { color: #5f87ff; } .eb69 { background-color: #5f87ff; }
.ef70 { color: #5faf00; } .eb70 { background-color: #5faf00; }
.ef71 { color: #5faf5f; } .eb71 { background-color: #5faf5f; }
.ef72 { color: #5faf87; } .eb72 { background-color: #5faf87; }
.ef73 { color: #5fafaf; } .eb73 { background-color: #5fafaf; }
.ef74 { color: #5fafd7; } .eb74 { background-color: #5fafd7; }
.ef75 { color: #5fafff; } .eb75 { background-color: #5fafff; }
.ef76 { color: #5fd700; } .eb76 { background-color: #5fd700; }
.ef77 { color: #5fd75f; } .eb77 { background-color: #5fd75f; }
.ef78 { color: #5fd787; } .eb78 { background-color: #5fd787; }
.ef79 { color: #5fd7af; } .eb79 { background-color: #5fd7af; }
.ef80 { color: #5fd7d7; } .eb80 { background-color: #5fd7d7; }
.ef81 { color: #5fd7ff; } .eb81 { background-color: #5fd7ff; }
.ef82 { color: #5fff00; } .eb82 { background-color: #5fff00; }
.ef83 { color: #5fff5f; } .eb83 { background-color: #5fff5f; }
.ef84 { color: #5fff87; } .eb84 { background-color: #5fff87; }
.ef85 { color: #5fffaf; } .eb85 { background-color: #5fffaf; }
.ef86 { color: #5fffd7; } .eb86 { background-color: #5fffd7; }
.ef87 { color: #5fffff; } .eb87 { background-color: #5fffff; }
.ef88 { color: #870000; } .eb88 { background-color: #870000; }
.ef89 { color: #87005f; } .eb89 { background-color: #87005f; }
.ef90 { color: #870087; } .eb90 { background-color: #870087; }
.ef91 { color: #8700af; } .eb91 { background-color: #8700af; }
.ef92 { color: #8700d7; } .eb92 { background-color: #8700d7; }
.ef93 { color: #8700ff; } .eb93 { background-color: #8700ff; }
.ef94 { color: #875f00; } .eb94 { background-color: #875f00; }
.ef95 { color: #875f5f; } .eb95 { background-color: #875f5f; }
.ef96 { color: #875f87; } .eb96 { background-color: #875f87; }
.ef97 { color: #875faf; } .eb97 { background-color: #875faf; }
.ef98 { color: #875fd7; } .eb98 { background-color: #875fd7; }
.ef99 { color: #875fff; } .eb99 { background-color: #875fff; }
.ef100 { color: #878700; } .eb100 { background-color: #878700; }
.ef101 { color: #87875f; } .eb101 { background-color: #87875f; }
.ef102 { color: #878787; } .eb102 { background-color: #878787; }
.ef103 { color: #8787af; } .eb103 { background-color: #8787af; }
.ef104 { color: #8787d7; } .eb104 { background-color: #8787d7; }
.ef105 { color: #8787ff; } .eb105 { background-color: #8787ff; }
.ef106 { color: #87af00; } .eb106 { background-color: #87af00; }
.ef107 { color: #87af5f; } .eb107 { background-color: #87af5f; }
.ef108 { color: #87af87; } .eb108 { background-color: #87af87; }
.ef109 { color: #87afaf; } .eb109 { background-color: #87afaf; }
.ef110 { color: #87afd7; } .eb110 { background-color: #87afd7; }
.ef111 { color: #87afff; } .eb111 { background-color: #87afff; }
.ef112 { color: #87d700; } .eb112 { background-color: #87d700; }
.ef113 { color: #87d75f; } .eb113 { background-color: #87d75f; }
.ef114 { color: #87d787; } .eb114 { background-color: #87d787; }
.ef115 { color: #87d7af; } .eb115 { background-color: #87d7af; }
.ef116 { color: #87d7d7; } .eb116 { background-color: #87d7d7; }
.ef117 { color: #87d7ff; } .eb117 { background-color: #87d7ff; }
.ef118 { color: #87ff00; } .eb118 { background-color: #87ff00; }
.ef119 { color: #87ff5f; } .eb119 { background-color: #87ff5f; }
.ef120 { color: #87ff87; } .eb120 { background-color: #87ff87; }
.ef121 { color: #87ffaf; } .eb121 { background-color: #87ffaf; }
.ef122 { color: #87ffd7; } .eb122 { background-color: #87ffd7; }
.ef123 { color: #87ffff; } .eb123 { background-color: #87ffff; }
.ef124 { color: #af0000; } .eb124 { background-color: #af0000; }
.ef125 { color: #af005f; } .eb125 { background-color: #af005f; }
.ef126 { color: #af0087; } .eb126 { background-color: #af0087; }
.ef127 { color: #af00af; } .eb127 { background-color: #af00af; }
.ef128 { color: #af00d7; } .eb128 { background-color: #af00d7; }
.ef129 { color: #af00ff; } .eb129 { background-color: #af00ff; }
.ef130 { color: #af5f00; } .eb130 { background-color: #af5f00; }
.ef131 { color: #af5f5f; } .eb131 { background-color: #af5f5f; }
.ef132 { color: #af5f87; } .eb132 { background-color: #af5f87; }
.ef133 { color: #af5faf; } .eb133 { background-color: #af5faf; }
.ef134 { color: #af5fd7; } .eb134 { background-color: #af5fd7; }
.ef135 { color: #af5fff; } .eb135 { background-color: #af5fff; }
.ef136 { color: #af8700; } .eb136 { background-color: #af8700; }
.ef137 { color: #af875f; } .eb137 { background-color: #af875f; }
.ef138 { color: #af8787; } .eb138 { background-color: #af8787; }
.ef139 { color: #af87af; } .eb139 { background-color: #af87af; }
.ef140 { color: #af87d7; } .eb140 { background-color: #af87d7; }
.ef141 { color: #af87ff; } .eb141 { background-color: #af87ff; }
.ef142 { color: #afaf00; } .eb142 { background-color: #afaf00; }
.ef143 { color: #afaf5f; } .eb143 { background-color: #afaf5f; }
.ef144 { color: #afaf87; } .eb144 { background-color: #afaf87; }
.ef145 { color: #afafaf; } .eb145 { background-color: #afafaf; }
.ef146 { color: #afafd7; } .eb146 { background-color: #afafd7; }
.ef147 { color: #afafff; } .eb147 { background-color: #afafff; }
.ef148 { color: #afd700; } .eb148 { background-color: #afd700; }
.ef149 { color: #afd75f; } .eb149 { background-color: #afd75f; }
.ef150 { color: #afd787; } .eb150 { background-color: #afd787; }
.ef151 { color: #afd7af; } .eb151 { background-color: #afd7af; }
.ef152 { color: #afd7d7; } .eb152 { background-color: #afd7d7; }
.ef153 { color: #afd7ff; } .eb153 { background-color: #afd7ff; }
.ef154 { color: #afff00; } .eb154 { background-color: #afff00; }
.ef155 { color: #afff5f; } .eb155 { background-color: #afff5f; }
.ef156 { color: #afff87; } .eb156 { background-color: #afff87; }
.ef157 { color: #afffaf; } .eb157 { background-color: #afffaf; }
.ef158 { color: #afffd7; } .eb158 { background-color: #afffd7; }
.ef159 { color: #afffff; } .eb159 { background-color: #afffff; }
.ef160 { color: #d70000; } .eb160 { background-color: #d70000; }
.ef161 { color: #d7005f; } .eb161 { background-color: #d7005f; }
.ef162 { color: #d70087; } .eb162 { background-color: #d70087; }
.ef163 { color: #d700af; } .eb163 { background-color: #d700af; }
.ef164 { color: #d700d7; } .eb164 { background-color: #d700d7; }
.ef165 { color: #d700ff; } .eb165 { background-color: #d700ff; }
.ef166 { color: #d75f00; } .eb166 { background-color: #d75f00; }
.ef167 { color: #d75f5f; } .eb167 { background-color: #d75f5f; }
.ef168 { color: #d75f87; } .eb168 { background-color: #d75f87; }
.ef169 { color: #d75faf; } .eb169 { background-color: #d75faf; }
.ef170 { color: #d75fd7; } .eb170 { background-color: #d75fd7; }
.ef171 { color: #d75fff; } .eb171 { background-color: #d75fff; }
.ef172 { color: #d78700; } .eb172 { background-color: #d78700; }
.ef173 { color: #d7875f; } .eb173 { background-color: #d7875f; }
.ef174 { color: #d78787; } .eb174 { background-color: #d78787; }
.ef175 { color: #d787af; } .eb175 { background-color: #d787af; }
.ef176 { color: #d787d7; } .eb176 { background-color: #d787d7; }
.ef177 { color: #d787ff; } .eb177 { background-color: #d787ff; }
.ef178 { color: #d7af00; } .eb178 { background-color: #d7af00; }
.ef179 { color: #d7af5f; } .eb179 { background-color: #d7af5f; }
.ef180 { color: #d7af87; } .eb180 { background-color: #d7af87; }
.ef181 { color: #d7afaf; } .eb181 { background-color: #d7afaf; }
.ef182 { color: #d7afd7; } .eb182 { background-color: #d7afd7; }
.ef183 { color: #d7afff; } .eb183 { background-color: #d7afff; }
.ef184 { color: #d7d700; } .eb184 { background-color: #d7d700; }
.ef185 { color: #d7d75f; } .eb185 { background-color: #d7d75f; }
.ef186 { color: #d7d787; } .eb186 { background-color: #d7d787; }
.ef187 { color: #d7d7af; } .eb187 { background-color: #d7d7af; }
.ef188 { color: #d7d7d7; } .eb188 { background-color: #d7d7d7; }
.ef189 { color: #d7d7ff; } .eb189 { background-color: #d7d7ff; }
.ef190 { color: #d7ff00; } .eb190 { background-color: #d7ff00; }
.ef191 { color: #d7ff5f; } .eb191 { background-color: #d7ff5f; }
.ef192 { color: #d7ff87; } .eb192 { background-color: #d7ff87; }
.ef193 { color: #d7ffaf; } .eb193 { background-color: #d7ffaf; }
.ef194 { color: #d7ffd7; } .eb194 { background-color: #d7ffd7; }
.ef195 { color: #d7ffff; } .eb195 { background-color: #d7ffff; }
.ef196 { color: #ff0000; } .eb196 { background-color: #ff0000; }
.ef197 { color: #ff005f; } .eb197 { background-color: #ff005f; }
.ef198 { color: #ff0087; } .eb198 { background-color: #ff0087; }
.ef199 { color: #ff00af; } .eb199 { background-color: #ff00af; }
.ef200 { color: #ff00d7; } .eb200 { background-color: #ff00d7; }
.ef201 { color: #ff00ff; } .eb201 { background-color: #ff00ff; }
.ef202 { color: #ff5f00; } .eb202 { background-color: #ff5f00; }
.ef203 { color: #ff5f5f; } .eb203 { background-color: #ff5f5f; }
.ef204 { color: #ff5f87; } .eb204 { background-color: #ff5f87; }
.ef205 { color: #ff5faf; } .eb205 { background-color: #ff5faf; }
.ef206 { color: #ff5fd7; } .eb206 { background-color: #ff5fd7; }
.ef207 { color: #ff5fff; } .eb207 { background-color: #ff5fff; }
.ef208 { color: #ff8700; } .eb208 { background-color: #ff8700; }
.ef209 { color: #ff875f; } .eb209 { background-color: #ff875f; }
.ef210 { color: #ff8787; } .eb210 { background-color: #ff8787; }
.ef211 { color: #ff87af; } .eb211 { background-color: #ff87af; }
.ef212 { color: #ff87d7; } .eb212 { background-color: #ff87d7; }
.ef213 { color: #ff87ff; } .eb213 { background-color: #ff87ff; }
.ef214 { color: #ffaf00; } .eb214 { background-color: #ffaf00; }
.ef215 { color: #ffaf5f; } .eb215 { background-color: #ffaf5f; }
.ef216 { color: #ffaf87; } .eb216 { background-color: #ffaf87; }
.ef217 { color: #ffafaf; } .eb217 { background-color: #ffafaf; }
.ef218 { color: #ffafd7; } .eb218 { background-color: #ffafd7; }
.ef219 { color: #ffafff; } .eb219 { background-color: #ffafff; }
.ef220 { color: #ffd700; } .eb220 { background-color: #ffd700; }
.ef221 { color: #ffd75f; } .eb221 { background-color: #ffd75f; }
.ef222 { color: #ffd787; } .eb222 { background-color: #ffd787; }
.ef223 { color: #ffd7af; } .eb223 { background-color: #ffd7af; }
.ef224 { color: #ffd7d7; } .eb224 { background-color: #ffd7d7; }
.ef225 { color: #ffd7ff; } .eb225 { background-color: #ffd7ff; }
.ef226 { color: #ffff00; } .eb226 { background-color: #ffff00; }
.ef227 { color: #ffff5f; } .eb227 { background-color: #ffff5f; }
.ef228 { color: #ffff87; } .eb228 { background-color: #ffff87; }
.ef229 { color: #ffffaf; } .eb229 { background-color: #ffffaf; }
.ef230 { color: #ffffd7; } .eb230 { background-color: #ffffd7; }
.ef231 { color: #ffffff; } .eb231 { background-color: #ffffff; }
.ef232 { color: #080808; } .eb232 { background-color: #080808; }
.ef233 { color: #121212; } .eb233 { background-color: #121212; }
.ef234 { color: #1c1c1c; } .eb234 { background-color: #1c1c1c; }
.ef235 { color: #262626; } .eb235 { background-color: #262626; }
.ef236 { color: #303030; } .eb236 { background-color: #303030; }
.ef237 { color: #3a3a3a; } .eb237 { background-color: #3a3a3a; }
.ef238 { color: #444444; } .eb238 { background-color: #444444; }
.ef239 { color: #4e4e4e; } .eb239 { background-color: #4e4e4e; }
.ef240 { color: #585858; } .eb240 { background-color: #585858; }
.ef241 { color: #626262; } .eb241 { background-color: #626262; }
.ef242 { color: #6c6c6c; } .eb242 { background-color: #6c6c6c; }
.ef243 { color: #767676; } .eb243 { background-color: #767676; }
.ef244 { color: #808080; } .eb244 { background-color: #808080; }
.ef245 { color: #8a8a8a; } .eb245 { background-color: #8a8a8a; }
.ef246 { color: #949494; } .eb246 { background-color: #949494; }
.ef247 { color: #9e9e9e; } .eb247 { background-color: #9e9e9e; }
.ef248 { color: #a8a8a8; } .eb248 { background-color: #a8a8a8; }
.ef249 { color: #b2b2b2; } .eb249 { background-color: #b2b2b2; }
.ef250 { color: #bcbcbc; } .eb250 { background-color: #bcbcbc; }
.ef251 { color: #c6c6c6; } .eb251 { background-color: #c6c6c6; }
.ef252 { color: #d0d0d0; } .eb252 { background-color: #d0d0d0; }
.ef253 { color: #dadada; } .eb253 { background-color: #dadada; }
.ef254 { color: #e4e4e4; } .eb254 { background-color: #e4e4e4; }
.ef255 { color: #eeeeee; } .eb255 { background-color: #eeeeee; }

.f9 { color: #000000; }
.b9 { background-color: #FFFFFF; }
.f9 > .bold,.bold > .f9, body.f9 > pre > .bold {
  /* Bold is heavy black on white, or bright white
     depending on the default background */
  color: #5555FF;
  font-weight: bold;
}
.reverse {
  /* CSS does not support swapping fg and bg colours unfortunately,
     so just hardcode something that will look OK on all backgrounds. */
  color: #000000; background-color: #AAAAAA;
}
.underline { text-decoration: underline; }
.line-through { text-decoration: line-through; }
.blink { text-decoration: blink; }

/* Avoid pixels between adjacent span elements.
   Note this only works for lines less than 80 chars
   where we close span elements on the same line.
span { display: inline-block; }
*/
</style>
</head>

<body class="f9 b9">
  <h1>说明：</h1>
  <ul>
  	<li>
  		<p>
  			本Demo使用的是
  			<a href="https://github.com/leancloud/leanchat-ios">leanCloud官方在2016.03.09提交的版本</a>
  		</p>
  	</li>
  	<li>
  		<p>
  			本Demo在leanCloud官方Demo的基础上集成了BQMM,在修改的地方我们都加上了“BQMM集成"的注释，可在项目中全局搜索查看
  		</p>
  	</li>
  	<li>
  		<p>
  			我们提供了集成之后的Demo与官方Demo的Diff文档,供大家查看 (绿色为新增的代码，红色为删除的代码)
  		</p>
  	</li>
  </ul>


  <h1>
  	集成之后的Demo与官方Demo的Diff文档：
  </h1>
<pre>
<span class="bold">diff --git a/LeanChat/LeanChat/CDAppDelegate.m b/LeanChat/LeanChat/CDAppDelegate.m</span>
<span class="bold">index 532c49b..ab4b6f0 100755</span>
<span class="bold">--- a/LeanChat/LeanChat/CDAppDelegate.m</span>
<span class="bold">+++ b/LeanChat/LeanChat/CDAppDelegate.m</span>
<span class="f6">@@ -23,6 +23,9 @@</span>
#import &lt;OpenShare/OpenShareHeader.h&gt;
#import &quot;MBProgressHUD.h&quot;

<span class="f2">//BQMM集成</span>
<span class="f2">#import &lt;BQMM/BQMM.h&gt;</span>

@interface CDAppDelegate()

@property (nonatomic, strong) CDLoginVC *loginVC;
<span class="f6">@@ -85,6 +88,11 @@</span> - (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(
    [AVPush setProductionMode:NO];  // 如果要测试申请好友是否有推送，请设置为 YES
//    [AVOSCloud setAllLogsEnabled:YES];
#endif

    <span class="f2">//BQMM集成  BQMM初始化</span>
<span class="f2">    [[MMEmotionCentre defaultCentre] setAppId:@&quot;appId&quot;</span>
<span class="f2">                                       secret:@&quot;appSecret&quot;];</span>

    return YES;
}

<span class="f6">@@ -108,6 +116,8 @@</span> - (void)applicationDidEnterBackground:(UIApplication *)application {
}

- (void)applicationWillEnterForeground:(UIApplication *)application {
    <span class="f2">//BQMM集成</span>
<span class="f2">    [[MMEmotionCentre defaultCentre] clearSession];</span>
}

- (void)applicationDidBecomeActive:(UIApplication *)application {
<span class="bold">diff --git a/LeanChat/LeanChat/Info.plist b/LeanChat/LeanChat/Info.plist</span>
<span class="bold">index db8b067..0ae838a 100755</span>
<span class="bold">--- a/LeanChat/LeanChat/Info.plist</span>
<span class="bold">+++ b/LeanChat/LeanChat/Info.plist</span>
<span class="f6">@@ -71,6 +71,8 @@</span>
	&lt;true/&gt;
	&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;
	&lt;dict&gt;
		<span class="f2">&lt;key&gt;NSAllowsArbitraryLoads&lt;/key&gt;</span>
<span class="f2">		&lt;true/&gt;</span>
		&lt;key&gt;NSExceptionDomains&lt;/key&gt;
		&lt;dict&gt;
			&lt;key&gt;clouddn.com&lt;/key&gt;
<span class="bold">diff --git a/LeanChat/Podfile b/LeanChat/Podfile</span>
<span class="bold">index 8e26561..1df2793 100755</span>
<span class="bold">--- a/LeanChat/Podfile</span>
<span class="bold">+++ b/LeanChat/Podfile</span>
<span class="f6">@@ -23,6 +23,7 @@</span> target 'LeanChat' do
    pod 'PopMenu', '2.4'
    pod 'CYLTabBarController'
    pod 'SDWebImage'
    <span class="f2">pod 'BQMM', '1.7.0'</span>

#    pod 'LeanCloudSocial', :path =&gt; '~/ios/leancloud-social-ios'
#    pod 'LeanCloudFeedback', :path =&gt; '~/ios/leancloud-feedback-ios/'
<span class="bold">diff --git a/LeanChatLib/Classes/controllers/CDChatRoomVC.m b/LeanChatLib/Classes/controllers/CDChatRoomVC.m</span>
<span class="bold">index af4f371..4c0bb2e 100755</span>
<span class="bold">--- a/LeanChatLib/Classes/controllers/CDChatRoomVC.m</span>
<span class="bold">+++ b/LeanChatLib/Classes/controllers/CDChatRoomVC.m</span>
<span class="f6">@@ -23,6 +23,10 @@</span>
#import &quot;CDFailedMessageStore.h&quot;
#import &quot;AVIMEmotionMessage.h&quot;

<span class="f2">//BQMM集成</span>
<span class="f2">#import &lt;BQMM/BQMM.h&gt;</span>
<span class="f2">#import &quot;CDMessageHelper.h&quot;</span>

static NSInteger const kOnePageSize = 10;

typedef void (^LCIMSendMessageSuccessBlock)(NSString *messageUUID);
<span class="f6">@@ -159,6 +163,20 @@</span> - (void)updateStatusView {
- (void)multiMediaMessageDidSelectedOnMessage:(id&lt;XHMessageModel&gt;)message atIndexPath:(NSIndexPath *)indexPath onMessageTableViewCell:(XHMessageTableViewCell *)messageTableViewCell {
    UIViewController *disPlayViewController;
    switch (message.messageMediaType) {
            <span class="f2">//BQMM集成  点击大表情消息时的处理</span>
<span class="f2">        case XHBubbleMessageMediaTypeText:</span>
<span class="f2">        {</span>
<span class="f2">            NSDictionary *attributes = [message attributes];</span>
<span class="f2">            if ([attributes[@&quot;txt_msgType&quot;] isEqualToString:@&quot;facetype&quot;]) {</span>
<span class="f2">                UITextView *textView = self.messageInputView.inputTextView;</span>
<span class="f2">                [textView endEditing:YES];</span>
<span class="f2">                [[MMEmotionCentre defaultCentre] switchToDefaultKeyboard];</span>
<span class="f2">                </span>
<span class="f2">                UIViewController *emojiController = [[MMEmotionCentre defaultCentre] controllerForEmotionCode:attributes[@&quot;msg_data&quot;][0][0]];</span>
<span class="f2">                [self.navigationController pushViewController:emojiController animated:YES];</span>
<span class="f2">            }</span>
<span class="f2">        }</span>
<span class="f2">            break;</span>
        case XHBubbleMessageMediaTypeVideo:
        case XHBubbleMessageMediaTypePhoto: {
            XHDisplayMediaViewController *messageDisplayTextView = [[XHDisplayMediaViewController alloc] init];
<span class="f6">@@ -255,14 +273,15 @@</span> - (void)loadMoreMessagesScrollTotop {

#pragma mark - didSend delegate

<span class="f2">//BQMM集成  发送消息回调</span>
//发送文本消息的回调方法
- (void)didSendText:(NSString *)text <span class="f2">attributes:(NSDictionary *)attributes</span> fromSender:(NSString *)sender onDate:(NSDate *)date {
    if ([CDChatManager manager].client.status != AVIMClientStatusOpened) {
        return;
    }
    if ([text length] &gt; 0 ) {
        XHMessage *xhMessage = [[XHMessage alloc] initWithText:[CDEmotionUtils emojiStringFromString:text] sender:sender timestamp:date];
        [self sendMessage:xhMessage <span class="f2">attributes:attributes</span>];
        [self finishSendMessageWithBubbleMessageType:XHBubbleMessageMediaTypeText];
    }
}
<span class="f6">@@ -282,7 +301,8 @@</span> - (void)didSendVideoConverPhoto:(UIImage *)videoConverPhoto videoPath:(NSString
        return;
    }
    AVIMVideoMessage *sendVideoMessage = [AVIMVideoMessage messageWithText:nil attachedFilePath:videoPath attributes:nil];
    <span class="f2">//BQMM集成</span>
    [self sendMessage:sendVideoMessage <span class="f2">attributes:nil</span>];
}

// 发送语音消息的回调方法
<span class="f6">@@ -312,7 +332,8 @@</span> - (void)didSendEmotion:(NSString *)emotion fromSender:(NSString *)sender onDate:
    } else {
        NSString *path = [[NSBundle mainBundle] pathForResource:emotion ofType:@&quot;gif&quot;];
        XHMessage *message = [[XHMessage alloc] initWithEmotionPath:path emotionName:emotion sender:sender timestamp:nil];
        <span class="f2">//BQMM集成</span>
        [self sendMessage:message <span class="f2">attributes:nil</span>];
        [self finishSendMessageWithBubbleMessageType:XHBubbleMessageMediaTypeEmotion];
    }
}
<span class="f6">@@ -444,7 +465,8 @@</span> - (void)sendImage:(UIImage *)image fromSender:(NSString *)sender {
                              sender:sender
                              timestamp:nil
                              ];
        <span class="f2">//BQMM集成</span>
        [self sendMessage:message <span class="f2">attributes:nil</span>];
    } else {
        [self alert:@&quot;write image to file error&quot;];
    }
<span class="f6">@@ -457,29 +479,32 @@</span> - (void)sendVoiceWithPath:(NSString *)voicePath fromSender:(NSString *)sender {
                                                       sender:sender
                                                    timestamp:nil
                          ];
    <span class="f2">//BQMM集成</span>
    [self sendMessage:message <span class="f2">attributes:nil</span>];
}

- (void)sendLocationWithLatitude:(double)latitude longitude:(double)longitude address:(NSString *)address {
    CLLocation *location = [[CLLocation alloc] initWithLatitude:latitude longitude:longitude];
    XHMessage *message = [[XHMessage alloc] initWithLocalPositionPhoto:[UIImage imageNamed:@&quot;Fav_Cell_Loc&quot;] geolocations:nil location:location sender:nil timestamp:nil];
    <span class="f2">//BQMM集成</span>
    [self sendMessage:message <span class="f2">attributes:nil</span>];
}

<span class="f2">//BQMM集成</span>
- (AVIMTypedMessage *)getAVIMTypedMessageWithMessage:(XHMessage *)message <span class="f2">attributes:(NSDictionary *)attributes</span> {
    AVIMTypedMessage *avimTypedMessage;
    switch (message.messageMediaType) {
        case XHBubbleMessageMediaTypeText: {
            avimTypedMessage = [AVIMTextMessage messageWithText:[CDEmotionUtils plainStringFromEmojiString:message.text] attributes:<span class="f1">nil</span><span class="f2">attributes</span>];
            break;
        }
        case XHBubbleMessageMediaTypeVideo:
        case XHBubbleMessageMediaTypePhoto: {
            avimTypedMessage = [AVIMImageMessage messageWithText:nil attachedFilePath:message.photoPath attributes:<span class="f1">nil</span><span class="f2">attributes</span>];
            break;
        }
        case XHBubbleMessageMediaTypeVoice: {
            avimTypedMessage = [AVIMAudioMessage messageWithText:nil attachedFilePath:message.voicePath attributes:<span class="f1">nil</span><span class="f2">attributes</span>];
            break;
        }

<span class="f6">@@ -489,16 +514,17 @@</span> - (AVIMTypedMessage *)getAVIMTypedMessageWithMessage:(XHMessage *)message {

        case XHBubbleMessageMediaTypeLocalPosition: {
            //TODO:
            // avimTypedMessage = [AVIMLocationMessage messageWithText:nil latitude:message.latitude longitude:message.longitude attributes:<span class="f1">nil</span><span class="f2">attributes</span>];
            break;
        }
    }
    avimTypedMessage.sendTimestamp = [[NSDate date] timeIntervalSince1970] * 1000;
    return avimTypedMessage;
}
<span class="f2">//BQMM集成 发送消息方法</span>
- (void)sendMessage:(XHMessage *)message <span class="f2">attributes:(NSDictionary *)attributes</span> {
    <span class="f2">message.attributes = attributes;</span>
    [self sendMessage:message <span class="f2">attributes:attributes</span> success:^(NSString *messageUUID) {
        [[CDSoundManager manager] playSendSoundIfNeed];
    } failed:^(NSString *messageUUID, NSError *error) {
        message.messageId = messageUUID;
<span class="f6">@@ -506,10 +532,11 @@</span> - (void)sendMessage:(XHMessage *)message {
    }];
}

<span class="f2">//BQMM集成</span>
- (void)sendMessage:(XHMessage *)message <span class="f2">attributes:(NSDictionary *)attributes</span> success:(LCIMSendMessageSuccessBlock)success failed:(LCIMErrorBlock)failed {
    message.conversationId = self.conversation.conversationId;
    message.status = XHMessageStatusSending;
    AVIMTypedMessage *avimTypedMessage = [self getAVIMTypedMessageWithMessage:message <span class="f2">attributes:attributes</span>];
    [self.avimTypedMessage addObject:avimTypedMessage];
    [self preloadMessageToTableView:message];

<span class="f6">@@ -542,7 +569,8 @@</span> - (void)resendMessageAtIndexPath:(NSIndexPath *)indexPath discardIfFailed:(BOOL)
    [self.messages removeObjectAtIndex:indexPath.row];
    [self.avimTypedMessage removeObjectAtIndex:indexPath.row];
    [self.messageTableView reloadData];
    <span class="f2">//BQMM集成</span>
    [self sendMessage:xhMessage <span class="f2">attributes:nil</span> success:^(NSString *messageUUID) {
        [[CDFailedMessageStore store] deleteFailedMessageByRecordId:messageUUID];
    } failed:^(NSString *messageUUID, NSError *error) {
        if (discardIfFailed) {
<span class="f6">@@ -654,9 +682,11 @@</span> - (XHMessage *)getXHMessageByMsg:(AVIMTypedMessage *)message {
            }
        }
        xhMessage.status = status;
<span class="f2">//</span>    } else {
        xhMessage.status = XHMessageStatusReceived;
    }
    <span class="f2">//BQMM集成</span>
<span class="f2">    xhMessage.attributes = message.attributes;</span>
    return xhMessage;
}

<span class="f6">@@ -674,7 +704,8 @@</span> - (NSMutableArray *)getXHMessages:(NSArray *)avimTypedMessage {
- (NSMutableArray *)getAVIMMessages:(NSArray&lt;XHMessage *&gt; *)xhMessages {
    NSMutableArray *messages = [[NSMutableArray alloc] init];
    for (XHMessage *message in xhMessages) {
        <span class="f2">//BQMM集成</span>
        AVIMTypedMessage *avimTypedMessage = [self getAVIMTypedMessageWithMessage:message <span class="f2">attributes:nil</span>];
        if (avimTypedMessage) {
            [messages addObject:avimTypedMessage];
        }
<span class="f6">@@ -813,6 +844,9 @@</span> - (void)insertMessage:(AVIMTypedMessage *)message {
    if (self.loadingMoreMessage) {
        return;
    }
    <span class="f2">//BQMM集成</span>
<span class="f2">    [CDMessageHelper convertAndroidAttributesToIos:message];</span>

    self.loadingMoreMessage = YES;
    [self cacheMessages:@[message] callback:^(BOOL succeeded, NSError *error) {
        if ([self filterError:error]) {
<span class="bold">diff --git a/LeanChatLib/Classes/data/CDChatManager.m b/LeanChatLib/Classes/data/CDChatManager.m</span>
<span class="bold">index 3abb278..d4d4368 100755</span>
<span class="bold">--- a/LeanChatLib/Classes/data/CDChatManager.m</span>
<span class="bold">+++ b/LeanChatLib/Classes/data/CDChatManager.m</span>
<span class="f6">@@ -14,6 +14,9 @@</span>
#import &quot;CDMacros.h&quot;
#import &quot;CDChatManager_Internal.h&quot;

<span class="f2">//BQMM集成</span>
<span class="f2">#import &quot;CDMessageHelper.h&quot;</span>

static CDChatManager *instance;

@interface CDChatManager () &lt;AVIMClientDelegate, AVIMSignatureDataSource&gt;
<span class="f6">@@ -233,6 +236,8 @@</span> - (void)queryTypedMessagesWithConversation:(AVIMConversation *)conversation time
        NSMutableArray *typedMessages = [NSMutableArray array];
        for (AVIMTypedMessage *message in messages) {
            if ([message isKindOfClass:[AVIMTypedMessage class]]) {
                <span class="f2">//BQMM集成</span>
<span class="f2">                [CDMessageHelper convertAndroidAttributesToIos:message];</span>
                [typedMessages addObject:message];
            }
        }
<span class="bold">diff --git a/LeanChatLib/Classes/data/CDMessageHelper.h b/LeanChatLib/Classes/data/CDMessageHelper.h</span>
<span class="bold">index 47bf248..d2e3f3c 100755</span>
<span class="bold">--- a/LeanChatLib/Classes/data/CDMessageHelper.h</span>
<span class="bold">+++ b/LeanChatLib/Classes/data/CDMessageHelper.h</span>
<span class="f6">@@ -26,4 +26,7 @@</span>
 */
- (NSAttributedString *)attributedStringWithMessage:(AVIMTypedMessage *)message conversation:(AVIMConversation *)conversation;

<span class="f2">//BQMM集成</span>
<span class="f2">+ (void)convertAndroidAttributesToIos:(AVIMTypedMessage *)message;</span>

@end
<span class="bold">diff --git a/LeanChatLib/Classes/data/CDMessageHelper.m b/LeanChatLib/Classes/data/CDMessageHelper.m</span>
<span class="bold">index 290fa4f..87dcb16 100755</span>
<span class="bold">--- a/LeanChatLib/Classes/data/CDMessageHelper.m</span>
<span class="bold">+++ b/LeanChatLib/Classes/data/CDMessageHelper.m</span>
<span class="f6">@@ -96,6 +96,16 @@</span> - (NSAttributedString *)attributedStringWithMessage:(AVIMTypedMessage *)message

    return attributedString;
}
<span class="f2">//BQMM集成</span>
<span class="f2">//兼容安卓</span>
<span class="f2">+ (void)convertAndroidAttributesToIos:(AVIMTypedMessage *)message {</span>
<span class="f2">    id msg_data = message.attributes[@&quot;msg_data&quot;];</span>
<span class="f2">    if ([msg_data isKindOfClass:[NSString class]]) {</span>
<span class="f2">        NSMutableDictionary *attributes = [NSMutableDictionary dictionaryWithDictionary:message.attributes];</span>
<span class="f2">        NSArray *dataArr = [NSJSONSerialization JSONObjectWithData:[msg_data dataUsingEncoding:NSUTF8StringEncoding] options:NSJSONReadingMutableContainers error:nil];</span>
<span class="f2">        attributes[@&quot;msg_data&quot;] = dataArr;</span>
<span class="f2">        message.attributes = attributes;</span>
<span class="f2">    }</span>
<span class="f2">}</span>

@end
<span class="bold">diff --git a/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Controllers/XHMessageTableViewController/XHMessageTableViewController.h b/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Controllers/XHMessageTableViewController/XHMessageTableViewController.h</span>
<span class="bold">index 9c0271c..0753b70 100755</span>
<span class="bold">--- a/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Controllers/XHMessageTableViewController/XHMessageTableViewController.h</span>
<span class="bold">+++ b/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Controllers/XHMessageTableViewController/XHMessageTableViewController.h</span>
<span class="f6">@@ -36,14 +36,16 @@</span>

@optional

<span class="f2">//BQMM集成</span>
/**
 *  发送文本消息的回调方法
 *
 *  @param text         目标文本字符串
 *  @param <span class="f2">attributes   消息扩展信息</span>
<span class="f2"> *  @param</span> sender       发送者的名字
 *  @param date         发送时间
 */
- (void)didSendText:(NSString *)text <span class="f2">attributes:(NSDictionary *)attributes</span> fromSender:(NSString *)sender onDate:(NSDate *)date;

/**
 *  发送图片消息的回调方法
<span class="bold">diff --git a/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Controllers/XHMessageTableViewController/XHMessageTableViewController.m b/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Controllers/XHMessageTableViewController/XHMessageTableViewController.m</span>
<span class="bold">index 72bcec8..5be25ce 100755</span>
<span class="bold">--- a/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Controllers/XHMessageTableViewController/XHMessageTableViewController.m</span>
<span class="bold">+++ b/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Controllers/XHMessageTableViewController/XHMessageTableViewController.m</span>
<span class="f6">@@ -13,6 +13,10 @@</span>
#import &quot;XHMessageTableViewController.h&quot;
#import &lt;MobileCoreServices/MobileCoreServices.h&gt;

<span class="f2">//BQMM集成</span>
<span class="f2">#import &lt;BQMM/BQMM.h&gt;</span>
<span class="f2">#import &quot;MMTextParser.h&quot;</span>

static void * const XHMessageInputTextViewContext = (void*)&amp;XHMessageInputTextViewContext;
static CGFloat const LCIMScrollViewInsetTop = 20.f;

<span class="f6">@@ -805,9 +809,10 @@</span> - (CGFloat)calculateCellHeightWithMessage:(id&lt;XHMessageModel&gt;)message atIndexPat
#pragma mark - Message Send helper Method

- (void)didSendMessageWithText:(NSString *)text {
    <span class="f2">//BQMM集成</span>
    DLog(@&quot;send text : %@&quot;, text);
    if ([self.delegate respondsToSelector:@selector(didSendText:<span class="f2">attributes:</span>fromSender:onDate:)]) {
        [self.delegate didSendText:text <span class="f2">attributes:nil</span> fromSender:self.messageSender onDate:[NSDate date]];
    }
}

<span class="f6">@@ -987,10 +992,33 @@</span> - (void)didInputAtSign:(XHMessageTextView *)messageInputTextView {
    }
}

- (void)<span class="f1">didSendTextAction</span><span class="f2">didSendTextWithTextView</span>:(<span class="f2">UITextView *)textView {</span>
<span class="f2">    //BQMM集成</span>
<span class="f2">    </span>
<span class="f2">    NSString *sendStr = textView.characterMMText;</span>
    NSString *<span class="f2">checkEmpty = [sendStr stringByTrimmingCharactersInSet:[NSCharacterSet whitespaceCharacterSet]];</span>
<span class="f2">    if ([checkEmpty isEqualToString:@&quot;&quot;]</span>) <span class="f2">{</span>
<span class="f2">        textView.</span>text <span class="f2">= @&quot;&quot;;</span>
<span class="f2">        return;</span>
<span class="f2">    }</span>
<span class="f2">    NSArray *textImgArray = textView.textImgArray;</span>
<span class="f2">    NSDictionary *mmExt = @</span>{<span class="f2">@&quot;txt_msgType&quot;:@&quot;emojitype&quot;,</span>
<span class="f2">                            @&quot;msg_data&quot;:[MMTextParser extDataWithTextImageArray:textImgArray]};;</span>
    DLog(@&quot;text : %@&quot;, <span class="f1">text</span><span class="f2">sendStr</span>);
    if ([self.delegate respondsToSelector:@selector(didSendText:<span class="f2">attributes:</span>fromSender:onDate:)]) {
        [self.delegate didSendText:<span class="f2">sendStr attributes:mmExt fromSender:self.messageSender onDate:[NSDate date]];</span>
<span class="f2">    }</span>
<span class="f2">}</span>

<span class="f2">//BQMM集成</span>
<span class="f2">- (void)didSendMMFaceAction:(MMEmoji *)emoji {</span>
<span class="f2">    NSDictionary *ext = @{@&quot;txt_msgType&quot;:@&quot;facetype&quot;,</span>
<span class="f2">                          @&quot;msg_data&quot;:[MMTextParser extDataWithEmoji:emoji]};</span>
<span class="f2">    NSString *sendStr = [NSString stringWithFormat:@&quot;[%@]&quot;, emoji.emojiName];</span>
<span class="f2">    </span>
<span class="f2">    DLog(@&quot;</span>text <span class="f2">: %@&quot;, sendStr);</span>
<span class="f2">    if ([self.delegate respondsToSelector:@selector(didSendText:attributes:fromSender:onDate:)]) {</span>
<span class="f2">        [self.delegate didSendText:sendStr attributes:ext</span> fromSender:self.messageSender onDate:[NSDate date]];
    }
}

<span class="f6">@@ -999,13 +1027,24 @@</span> - (void)didSelectedMultipleMediaAction {
    self.textViewInputViewType = XHInputViewTypeShareMenu;
    [self layoutOtherMenuViewHiden:NO];
}
<span class="f2">//BQMM集成</span>
- (void)didSendFaceAction:(BOOL)sendFace {
<span class="f2">//    if (sendFace) {</span>
<span class="f2">//        self.textViewInputViewType = XHInputViewTypeEmotion;</span>
<span class="f2">//        [self layoutOtherMenuViewHiden:NO];</span>
<span class="f2">//    } else {</span>
<span class="f2">//        [self.messageInputView.inputTextView becomeFirstResponder];</span>
<span class="f2">//    }</span>
<span class="f2">    </span>
<span class="f2">    //替换为表情mm键盘</span>
<span class="f2">    if (![self.messageInputView.inputTextView isFirstResponder]) {</span>
<span class="f2">        [self.messageInputView.inputTextView becomeFirstResponder];</span>
<span class="f2">    }</span>

    if (sendFace) {
<span class="f1">self.textViewInputViewType = XHInputViewTypeEmotion;</span>        [<span class="f1">self layoutOtherMenuViewHiden</span><span class="f2">[MMEmotionCentre defaultCentre] attachEmotionKeyboardToInput</span>:<span class="f1">NO</span><span class="f2">self.messageInputView.inputTextView</span>];
    } else {
        [<span class="f1">self.messageInputView.inputTextView becomeFirstResponder</span><span class="f2">[MMEmotionCentre defaultCentre] switchToDefaultKeyboard</span>];
    }
}

<span class="f6">@@ -1238,4 +1277,4 @@</span> - (void)observeValueForKeyPath:(NSString *)keyPath
    }
}

@end
<span class="bold">diff --git a/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Models/XHMessage.h b/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Models/XHMessage.h</span>
<span class="bold">index 79e8379..bfd7e54 100755</span>
<span class="bold">--- a/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Models/XHMessage.h</span>
<span class="bold">+++ b/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Models/XHMessage.h</span>
<span class="f6">@@ -51,6 +51,9 @@</span>

@property (nonatomic,assign) XHMessageStatus status;

<span class="f2">//BQMM集成</span>
<span class="f2">@property (nonatomic, strong) NSDictionary *attributes;</span>

/*!
 * just for failed message store, not meaning messageId
 */
<span class="bold">diff --git a/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Models/XHMessageModel.h b/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Models/XHMessageModel.h</span>
<span class="bold">index d19a0c0..299f39c 100755</span>
<span class="bold">--- a/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Models/XHMessageModel.h</span>
<span class="bold">+++ b/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Models/XHMessageModel.h</span>
<span class="f6">@@ -44,6 +44,8 @@</span> typedef NS_ENUM(NSInteger, XHMessageStatus){

- (UIImage *)avator;
- (NSString *)avatorUrl;
<span class="f2">//BQMM集成</span>
<span class="f2">- (NSDictionary *)attributes;</span>

- (XHBubbleMessageMediaType)messageMediaType;

<span class="bold">diff --git a/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageContentViews/XHMessageBubbleView.h b/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageContentViews/XHMessageBubbleView.h</span>
<span class="bold">index 39504eb..a2bcfe2 100755</span>
<span class="bold">--- a/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageContentViews/XHMessageBubbleView.h</span>
<span class="bold">+++ b/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageContentViews/XHMessageBubbleView.h</span>
<span class="f6">@@ -34,6 +34,8 @@</span>
#define kXHMessageBubbleDisplayMaxLine 200

#define kXHTextLineSpacing 3.0
<span class="f2">//BQMM集成</span>
<span class="f2">@class MMTextView;</span>

@interface XHMessageBubbleView : UIView

<span class="f6">@@ -45,7 +47,8 @@</span>
/**
 *  自定义显示文本消息控件，子类化的原因有两个，第一个是屏蔽Menu的显示。第二是传递手势到下一层，因为文本需要双击的手势
 */
<span class="f2">//BQMM集成</span>
@property (nonatomic, weak, readonly) <span class="f1">SETextView</span><span class="f2">MMTextView</span> *displayTextView;

/**
 *  用于显示气泡的ImageView控件
<span class="bold">diff --git a/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageContentViews/XHMessageBubbleView.m b/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageContentViews/XHMessageBubbleView.m</span>
<span class="bold">index 6ddeba9..01efe3c 100755</span>
<span class="bold">--- a/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageContentViews/XHMessageBubbleView.m</span>
<span class="bold">+++ b/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageContentViews/XHMessageBubbleView.m</span>
<span class="f6">@@ -9,6 +9,10 @@</span>
#import &quot;XHMessageBubbleView.h&quot;

#import &quot;XHMessageBubbleHelper.h&quot;
<span class="f2">//BQMM集成</span>
<span class="f2">#import &lt;BQMM/BQMM.h&gt;</span>
<span class="f2">#import &quot;MMTextView.h&quot;</span>
<span class="f2">#import &quot;MMTextParser.h&quot;</span>

static CGFloat const kMarginTop = 8.0f;
static CGFloat const kMarginBottom = 2.0f;
<span class="f6">@@ -20,8 +24,8 @@</span>
#define kXHArrowMarginWidth 14

@interface XHMessageBubbleView ()
<span class="f2">//BQMM集成</span>
@property (nonatomic, weak, readwrite) <span class="f1">SETextView</span><span class="f2">MMTextView</span> *displayTextView;

@property (nonatomic, weak, readwrite) UIImageView *bubbleImageView;

<span class="f6">@@ -44,26 +48,26 @@</span> @interface XHMessageBubbleView ()
@implementation XHMessageBubbleView

#pragma mark - Bubble view
<span class="f2">//BQMM集成</span>
<span class="f2">//</span>+ (CGFloat)neededWidthForText:(NSString *)text {
<span class="f2">//</span>    NSAttributedString *attributedText =
<span class="f2">//</span>    [[NSAttributedString alloc] initWithString:text
<span class="f2">//</span>                                    attributes:@{NSFontAttributeName: [[XHMessageBubbleView appearance] font]}];
<span class="f2">//</span>    CGRect rect = [attributedText boundingRectWithSize:(CGSize){CGFLOAT_MAX, CGFLOAT_MAX}
<span class="f2">//</span>                                               options:NSStringDrawingUsesLineFragmentOrigin
<span class="f2">//</span>                                               context:nil];
<span class="f2">//</span>    CGSize size = rect.size;
<span class="f2">//</span>    return ceilf(size.width);
<span class="f2">//</span>}
<span class="f2">//</span>
<span class="f2">//</span>+ (CGSize)neededSizeForText:(NSString *)text {
<span class="f2">//</span>    CGFloat maxWidth = CGRectGetWidth([[UIScreen mainScreen] bounds]) * (kIsiPad ? 0.8 : 0.55);
<span class="f2">//    </span>
<span class="f2">//</span>    CGFloat dyWidth = [XHMessageBubbleView neededWidthForText:text];
<span class="f2">//    </span>
<span class="f2">//</span>    CGSize textSize = [SETextView frameRectWithAttributtedString:[[XHMessageBubbleHelper sharedMessageBubbleHelper] bubbleAttributtedStringWithText:text] constraintSize:CGSizeMake(maxWidth, MAXFLOAT) lineSpacing:kXHTextLineSpacing font:[[XHMessageBubbleView appearance] font]].size;
<span class="f2">//</span>    return CGSizeMake((dyWidth &gt; textSize.width ? textSize.width : dyWidth) + kBubblePaddingRight * 2 + kXHArrowMarginWidth, textSize.height + kMarginTop * 2);
<span class="f2">//</span>}

+ (CGSize)neededSizeForPhoto:(UIImage *)photo {
    // 这里需要缩放后的size
<span class="f6">@@ -86,9 +90,24 @@</span> + (CGFloat)calculateCellHeightWithMessage:(id&lt;XHMessageModel&gt;)message {

+ (CGSize)getBubbleFrameWithMessage:(id&lt;XHMessageModel&gt;)message {
    CGSize bubbleSize;
    <span class="f2">//BQMM集成</span>
    switch (message.messageMediaType) {
        case XHBubbleMessageMediaTypeText: {
            <span class="f2">CGFloat maxWidth = CGRectGetWidth([[UIScreen mainScreen] bounds]) * (kIsiPad ? 0.8 : 0.55);</span>
<span class="f2">            </span>
<span class="f2">            NSDictionary *attributes = [message attributes];</span>
<span class="f2">            NSString *txt_msgType = attributes[@&quot;txt_msgType&quot;];</span>
<span class="f2">            if (txt_msgType) {</span>
<span class="f2">                if ([txt_msgType isEqualToString:@&quot;emojitype&quot;]) {       //图文混排</span>
                    bubbleSize = [<span class="f2">MMTextParser sizeForMMTextWithExtData:attributes[@&quot;msg_data&quot;] font:[[</span>XHMessageBubbleView <span class="f1">neededSizeForText</span><span class="f2">appearance] font] maximumTextWidth:maxWidth];</span>
<span class="f2">                } else if ([txt_msgType isEqualToString:@&quot;facetype&quot;]) { //大表情</span>
<span class="f2">                    bubbleSize = CGSizeMake(120, 120);</span>
<span class="f2">                }</span>
<span class="f2">            } else {    //纯文字</span>
<span class="f2">                bubbleSize = [MMTextParser sizeForTextWithText</span>:message.text <span class="f2">font:[[XHMessageBubbleView appearance] font] maximumTextWidth:maxWidth</span>];
            <span class="f2">}</span>
<span class="f2">            bubbleSize.width +=  kBubblePaddingRight * 2 + kXHArrowMarginWidth;</span>
<span class="f2">            bubbleSize.height += kMarginTop * 2;</span>
            break;
        }
        case XHBubbleMessageMediaTypePhoto: {
<span class="f6">@@ -174,8 +193,11 @@</span> - (void)configureBubbleImageView:(id&lt;XHMessageModel&gt;)message {
            // 只要是文本、语音、第三方表情，都需要把显示尖嘴图片的控件隐藏了
            _bubblePhotoImageView.hidden = YES;

            <span class="f2">//BQMM集成</span>
<span class="f2">            NSDictionary *attributes = [message attributes];</span>
<span class="f2">            NSString *txt_msgType = attributes[@&quot;txt_msgType&quot;];</span>

            if (currentType == XHBubbleMessageMediaTypeText <span class="f2">&amp;&amp; ![txt_msgType isEqualToString:@&quot;facetype&quot;]</span>) {
                // 如果是文本消息，那文本消息的控件需要显示
                _displayTextView.hidden = NO;
                // 那语言的gif动画imageView就需要隐藏了
<span class="f6">@@ -228,7 +250,34 @@</span> - (void)configureBubbleImageView:(id&lt;XHMessageModel&gt;)message {
- (void)configureMessageDisplayMediaWithMessage:(id&lt;XHMessageModel&gt;)message {
    switch (message.messageMediaType) {
        case XHBubbleMessageMediaTypeText:
            <span class="f2">//BQMM集成</span>
<span class="f2">        {</span>
<span class="f2">            NSDictionary *attributes = [message attributes];</span>
<span class="f2">            NSString *txt_msgType = attributes[@&quot;txt_msgType&quot;];</span>
<span class="f2">            if (txt_msgType) {</span>
<span class="f2">                if ([txt_msgType isEqualToString:@&quot;emojitype&quot;]) {       //图文混排</span>
<span class="f2">                    [</span>_displayTextView <span class="f2">setMmTextData:attributes[@&quot;msg_data&quot;]];</span>
<span class="f2">                } else if ([txt_msgType isEqualToString:@&quot;facetype&quot;]) { //大表情</span>
<span class="f2">                    NSArray *codes = nil;</span>
<span class="f2">                    if (attributes[@&quot;msg_data&quot;]) {</span>
<span class="f2">                        codes = @[attributes[@&quot;msg_data&quot;][0][0]];</span>
<span class="f2">                    }</span>
<span class="f2">                    </span>
<span class="f2">                    [[MMEmotionCentre defaultCentre] fetchEmojisByType:MMFetchTypeBig codes:codes completionHandler:^(NSArray *emojis) {</span>
<span class="f2">                        if (emojis</span>.<span class="f1">attributedText</span><span class="f2">count &gt; 0) {</span>
<span class="f2">                            MMEmoji *emoji = emojis[0];</span>
<span class="f2">                            FLAnimatedImage *animatedImage</span> = [[<span class="f1">XHMessageBubbleHelper sharedMessageBubbleHelper</span><span class="f2">FLAnimatedImage alloc</span>] <span class="f1">bubbleAttributtedStringWithText</span><span class="f2">initWithAnimatedGIFData</span>:<span class="f2">emoji.emojiData];</span>
<span class="f2">                            _emotionImageView.animatedImage = animatedImage;</span>
<span class="f2">                        }</span>
<span class="f2">                        else {</span>
<span class="f2">                            _emotionImageView.animatedImage = nil;</span>
<span class="f2">                        }</span>
<span class="f2">                    }];</span>
<span class="f2">                }</span>
<span class="f2">            } else {    //纯文字</span>
<span class="f2">                _displayTextView.text =</span> [message text]<span class="f1">]</span>;
            <span class="f2">}</span>
<span class="f2">        }</span>
            break;
        case XHBubbleMessageMediaTypePhoto:
            [_bubblePhotoImageView configureMessagePhoto:message.photo thumbnailUrl:message.thumbnailUrl originPhotoUrl:message.originPhotoUrl onBubbleMessageType:self.message.bubbleMessageType];
<span class="f6">@@ -276,14 +325,15 @@</span> - (instancetype)initWithFrame:(CGRect)frame
        }

        // 2、初始化显示文本消息的TextView
        <span class="f2">//BQMM集成</span>
        if (!_displayTextView) {
            <span class="f1">SETextView</span><span class="f2">MMTextView</span> *displayTextView = [[<span class="f1">SETextView</span><span class="f2">MMTextView</span> alloc] initWithFrame:CGRectZero];
            displayTextView.backgroundColor = [UIColor clearColor];
            displayTextView.selectable = NO;
<span class="f2">//</span>            displayTextView.lineSpacing = kXHTextLineSpacing;
            displayTextView<span class="f1">.font</span><span class="f2">.mmFont</span> = [[XHMessageBubbleView appearance] font];
<span class="f2">//</span>            displayTextView.showsEditingMenuAutomatically = NO;
<span class="f2">//</span>            displayTextView.highlighted = NO;
            [self addSubview:displayTextView];
            _displayTextView = displayTextView;
        }
<span class="f6">@@ -327,6 +377,8 @@</span> - (instancetype)initWithFrame:(CGRect)frame
        // 5、初始化显示gif表情的控件
        if (!_emotionImageView) {
            FLAnimatedImageView *emotionImageView = [[FLAnimatedImageView alloc] initWithFrame:CGRectZero];
            <span class="f2">//BQMM集成</span>
<span class="f2">            emotionImageView.userInteractionEnabled = YES;</span>
            [self addSubview:emotionImageView];
            _emotionImageView = emotionImageView;
        }
<span class="bold">diff --git a/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageContentViews/XHMessageTableViewCell.m b/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageContentViews/XHMessageTableViewCell.m</span>
<span class="bold">index 41f4d4b..c0e9e91 100755</span>
<span class="bold">--- a/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageContentViews/XHMessageTableViewCell.m</span>
<span class="bold">+++ b/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageContentViews/XHMessageTableViewCell.m</span>
<span class="f6">@@ -12,6 +12,10 @@</span>
#import &quot;XHMessageTableViewCell.h&quot;
#import &quot;XHMessageStatusView.h&quot;

<span class="f2">//BQMM集成</span>
<span class="f2">#import &quot;MMTextView.h&quot;</span>
<span class="f2">#import &quot;MMTextParser.h&quot;</span>

NSString *const senderCellIdentifier = @&quot;XHMessageTableViewCellSender&quot;;
NSString *const receiverCellIdentifier = @&quot;XHMessageTableViewCellReceiver&quot;;

<span class="f6">@@ -149,7 +153,16 @@</span> - (BOOL)canPerformAction:(SEL)action withSender:(id)sender {
- (void)copied:(id)sender {
    switch (self.messageBubbleView.message.messageMediaType) {
        case XHBubbleMessageMediaTypeText:
            <span class="f1">[</span><span class="f2">//BQMM集成</span>
<span class="f2">        {</span>
<span class="f2">            UIPasteboard *pasteboard =</span> [UIPasteboard generalPasteboard]<span class="f2">;</span>
<span class="f2">            NSDictionary *attributes = [self.messageBubbleView.message attributes];</span>
<span class="f2">            if ([attributes[@&quot;txt_msgType&quot;] isEqualToString:@&quot;emojitype&quot;]) {</span>
<span class="f2">                [pasteboard setString:[MMTextParser stringWithExtData:attributes[@&quot;msg_data&quot;]]];</span>
<span class="f2">            } else {</span>
<span class="f2">                [pasteboard</span> setString:<span class="f2">[</span>self.messageBubbleView.<span class="f1">displayTextView.</span><span class="f2">message</span> text]<span class="f2">]</span>;
            <span class="f2">}</span>
<span class="f2">        }</span>
            break;
        case XHBubbleMessageMediaTypePhoto:
            [[UIPasteboard generalPasteboard] setImage:self.messageBubbleView.bubblePhotoImageView.messagePhoto];
<span class="f6">@@ -227,6 +240,7 @@</span> - (void)configAvatorWithMessage:(id&lt;XHMessageModel&gt;)message {
    }
}

<span class="f2">//BQMM集成</span>
- (void)configureMessageBubbleViewWithMessage:(id&lt;XHMessageModel&gt;)message {
    XHBubbleMessageMediaType currentMediaType = message.messageMediaType;
    for (UIGestureRecognizer *gesTureRecognizer in self.messageBubbleView.bubbleImageView.gestureRecognizers) {
<span class="f6">@@ -243,16 +257,24 @@</span> - (void)configureMessageBubbleViewWithMessage:(id&lt;XHMessageModel&gt;)message {
            [self.messageBubbleView.bubblePhotoImageView addGestureRecognizer:tapGestureRecognizer];
            break;
        }
        case XHBubbleMessageMediaTypeText:<span class="f1">case XHBubbleMessageMediaTypeVoice:</span>
<span class="f1">        case XHBubbleMessageMediaTypeEmotion:</span> {
            UITapGestureRecognizer *tapGestureRecognizer <span class="f2">= nil;</span>
<span class="f2">            NSDictionary *attributes = [message attributes]</span>;
            if (<span class="f1">currentMediaType == XHBubbleMessageMediaTypeText) {</span>
<span class="f1">                tapGestureRecognizer =</span>[<span class="f2">attributes</span>[<span class="f1">UITapGestureRecognizer alloc</span><span class="f2">@&quot;txt_msgType&quot;</span>] <span class="f1">initWithTarget:self action</span><span class="f2">isEqualToString</span>:@<span class="f1">selector(doubleTapGestureRecognizerHandle:)</span><span class="f2">&quot;facetype&quot;</span>]<span class="f1">;</span>
<span class="f1">            } else</span><span class="f2">)</span> {
                tapGestureRecognizer = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(sigleTapGestureRecognizerHandle:)];
                <span class="f2">tapGestureRecognizer.numberOfTapsRequired = 1;</span>
<span class="f2">                [self.messageBubbleView.emotionImageView addGestureRecognizer:tapGestureRecognizer];</span>
<span class="f2">            } else {</span>
<span class="f2">                tapGestureRecognizer = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(doubleTapGestureRecognizerHandle:)];</span>
<span class="f2">                tapGestureRecognizer.numberOfTapsRequired = 2;</span>
<span class="f2">                [self.messageBubbleView.displayTextView addGestureRecognizer:tapGestureRecognizer];</span>
            }
            <span class="f2">break;</span>
<span class="f2">        }</span>
<span class="f2">        case XHBubbleMessageMediaTypeVoice:</span>
<span class="f2">        case XHBubbleMessageMediaTypeEmotion: {</span>
<span class="f2">            UITapGestureRecognizer *</span>tapGestureRecognizer<span class="f1">.numberOfTapsRequired</span> = <span class="f2">[[UITapGestureRecognizer alloc] initWithTarget:self action:@selector</span>(<span class="f1">currentMediaType == XHBubbleMessageMediaTypeText ? 2</span><span class="f2">sigleTapGestureRecognizerHandle</span>:<span class="f1">1</span>)<span class="f2">];</span>
<span class="f2">            tapGestureRecognizer.numberOfTapsRequired = 1</span>;
            [self.messageBubbleView.bubbleImageView addGestureRecognizer:tapGestureRecognizer];
            break;
        }
<span class="bold">diff --git a/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageInputView/XHMessageInputView.h b/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageInputView/XHMessageInputView.h</span>
<span class="bold">index 0d22562..33d0ae8 100755</span>
<span class="bold">--- a/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageInputView/XHMessageInputView.h</span>
<span class="bold">+++ b/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageInputView/XHMessageInputView.h</span>
<span class="f6">@@ -10,6 +10,9 @@</span>

#import &quot;XHMessageTextView.h&quot;

<span class="f2">//BQMM集成</span>
<span class="f2">@class MMEmoji;</span>

typedef NS_ENUM(NSInteger, XHMessageInputViewStyle) {
    // 分两种,一种是iOS6样式的，一种是iOS7样式的
    XHMessageInputViewStyleQuasiphysical,
<span class="f6">@@ -55,7 +58,15 @@</span> typedef NS_ENUM(NSInteger, XHMessageInputViewStyle) {
 *
 *  @param text 目标文本消息
 */
- <span class="f1">(void)didSendTextAction:(NSString *)text;</span><span class="f2">(void)didSendTextWithTextView:(UITextView *)textView;</span>

<span class="f2">//BQMM集成</span>
<span class="f2">/**</span>
<span class="f2"> *  发送表情mm 大表情</span>
<span class="f2"> *</span>
<span class="f2"> *  @param emoji 目标表情对象</span>
<span class="f2"> */</span>
<span class="f2">- (void)didSendMMFaceAction:(MMEmoji *)emoji;</span>

/**
 *  点击+号按钮Action
<span class="bold">diff --git a/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageInputView/XHMessageInputView.m b/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageInputView/XHMessageInputView.m</span>
<span class="bold">index eca9887..f23be1a 100755</span>
<span class="bold">--- a/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageInputView/XHMessageInputView.m</span>
<span class="bold">+++ b/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageInputView/XHMessageInputView.m</span>
<span class="f6">@@ -11,13 +11,15 @@</span>

#import &quot;NSString+MessageInputView.h&quot;
#import &quot;XHMacro.h&quot;
<span class="f2">//BQMM集成</span>
<span class="f2">#import &lt;BQMM/BQMM.h&gt;</span>

#define kXHTouchToRecord         @&quot;按住 说话&quot;
#define kXHTouchToFinish         @&quot;松开 结束&quot;

#define MIN_AUDIO_RECORDING_INTERVAL 1
<span class="f2">//BQMM集成</span>
@interface XHMessageInputView () &lt;UITextViewDelegate<span class="f2">, MMEmotionCentreDelegate</span>&gt;

@property (nonatomic, weak, readwrite) XHMessageTextView *inputTextView;

<span class="f6">@@ -448,6 +450,9 @@</span> - (void)setup {
    _allowsSendMultiMedia = YES;

    _messageInputViewStyle = XHMessageInputViewStyleFlat;
    <span class="f2">//BQMM集成</span>
<span class="f2">    [MMEmotionCentre defaultCentre].delegate = self;</span>
<span class="f2">    [[MMEmotionCentre defaultCentre] shouldShowShotcutPopoverAboveView:_faceSendButton withInput:_inputTextView];</span>
}

- (void)awakeFromNib {
<span class="f6">@@ -547,8 +552,9 @@</span> - (void)textViewDidEndEditing:(UITextView *)textView {

- (BOOL)textView:(UITextView *)textView shouldChangeTextInRange:(NSRange)range replacementText:(NSString *)text {
    if ([text isEqualToString:@&quot;\n&quot;]) {
        if ([self.delegate respondsToSelector:@selector(<span class="f1">didSendTextAction</span><span class="f2">didSendTextWithTextView</span>:)]) {
            <span class="f2">//BQMM集成</span>
            [self.delegate <span class="f1">didSendTextAction</span><span class="f2">didSendTextWithTextView</span>:textView<span class="f1">.text</span>];
        }
        return NO;
    } else if ([text isEqualToString:@&quot;@&quot;]) {
<span class="f6">@@ -560,4 +566,56 @@</span> - (BOOL)textView:(UITextView *)textView shouldChangeTextInRange:(NSRange)range r
    return YES;
}

<span class="f2">//BQMM集成  开始</span>
<span class="f2">- (void)textViewDidChange:(UITextView *)textView {</span>
<span class="f2">    </span>
<span class="f2">}</span>

<span class="f2">#pragma mark - MMEmotionCentreDelegate</span>

<span class="f2">- (void)didSelectEmoji:(MMEmoji *)emoji {</span>
<span class="f2">    if ([self.delegate respondsToSelector:@selector(didSendMMFaceAction:)]) {</span>
<span class="f2">        [self.delegate didSendMMFaceAction:emoji];</span>
<span class="f2">    }</span>
<span class="f2">}</span>

<span class="f2">- (void)didSelectTipEmoji:(MMEmoji *)emoji {</span>
<span class="f2">    if ([self.delegate respondsToSelector:@selector(didSendMMFaceAction:)]) {</span>
<span class="f2">        [self.delegate didSendMMFaceAction:emoji];</span>
<span class="f2">        self.inputTextView.text = @&quot;&quot;;</span>
<span class="f2">    }</span>
<span class="f2">}</span>

<span class="f2">- (void)didSendWithInput:(UIResponder&lt;UITextInput&gt; *)input {</span>
<span class="f2">    if ([input isKindOfClass:[UITextView class]] ) {</span>
<span class="f2">        if ([self.delegate respondsToSelector:@selector(didSendTextWithTextView:)]) {</span>
<span class="f2">            [self.delegate didSendTextWithTextView:(UITextView *)input];</span>
<span class="f2">        }</span>
<span class="f2">    }</span>
<span class="f2">}</span>

<span class="f2">- (void)tapOverlay {</span>
<span class="f2">    self.faceSendButton.selected = NO;</span>
<span class="f2">}</span>

<span class="f2">//BQMM集成  结束</span>
@end



















<span class="bold">diff --git a/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageInputView/XHMessageTextView.m b/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageInputView/XHMessageTextView.m</span>
<span class="bold">index 14806de..24f64eb 100755</span>
<span class="bold">--- a/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageInputView/XHMessageTextView.m</span>
<span class="bold">+++ b/LeanChatLib/Classes/vendor/MessageDisplayKit/Classes/Views/MessageInputView/XHMessageTextView.m</span>
<span class="f6">@@ -8,6 +8,9 @@</span>

#import &quot;XHMessageTextView.h&quot;

<span class="f2">//BQMM集成</span>
<span class="f2">#import &lt;BQMM/BQMM.h&gt;</span>

@implementation XHMessageTextView

#pragma mark - Setters
<span class="bold">diff --git a/LeanChatLib/LeanChatLib.xcodeproj/project.pbxproj b/LeanChatLib/LeanChatLib.xcodeproj/project.pbxproj</span>
<span class="bold">index 1d295ff..e09c063 100755</span>
<span class="bold">--- a/LeanChatLib/LeanChatLib.xcodeproj/project.pbxproj</span>
<span class="bold">+++ b/LeanChatLib/LeanChatLib.xcodeproj/project.pbxproj</span>
<span class="f6">@@ -1729,12 +1729,12 @@</span>
			isa = PBXNativeTarget;
			buildConfigurationList = 7073F95C1B1467F6006F2692 /* Build configuration list for PBXNativeTarget &quot;LeanChatLib&quot; */;
			buildPhases = (
				C79B42ADF7E874AD05B615FE /* <span class="f2">[CP]</span> Check Pods Manifest.lock */,
				7073F9411B1467F5006F2692 /* Sources */,
				7073F9421B1467F5006F2692 /* Frameworks */,
				7073F9431B1467F5006F2692 /* Headers */,
				7073F9441B1467F5006F2692 /* Resources */,
				F076F1D9170BF2EEB95F4880 /* <span class="f2">[CP]</span> Copy Pods Resources */,
			);
			buildRules = (
			);
<span class="f6">@@ -1945,14 +1945,14 @@</span>
/* End PBXResourcesBuildPhase section */

/* Begin PBXShellScriptBuildPhase section */
		C79B42ADF7E874AD05B615FE /* <span class="f2">[CP]</span> Check Pods Manifest.lock */ = {
			isa = PBXShellScriptBuildPhase;
			buildActionMask = 2147483647;
			files = (
			);
			inputPaths = (
			);
			name = <span class="f1">&quot;Check</span><span class="f2">&quot;[CP] Check</span> Pods Manifest.lock&quot;;
			outputPaths = (
			);
			runOnlyForDeploymentPostprocessing = 0;
<span class="f6">@@ -1960,14 +1960,14 @@</span>
			shellScript = &quot;diff \&quot;${PODS_ROOT}/../Podfile.lock\&quot; \&quot;${PODS_ROOT}/Manifest.lock\&quot; &gt; /dev/null\nif [[ $? != 0 ]] ; then\n    cat &lt;&lt; EOM\nerror: The sandbox is not in sync with the Podfile.lock. Run 'pod install' or update your CocoaPods installation.\nEOM\n    exit 1\nfi\n&quot;;
			showEnvVarsInLog = 0;
		};
		F076F1D9170BF2EEB95F4880 /* <span class="f2">[CP]</span> Copy Pods Resources */ = {
			isa = PBXShellScriptBuildPhase;
			buildActionMask = 2147483647;
			files = (
			);
			inputPaths = (
			);
			name = <span class="f1">&quot;Copy</span><span class="f2">&quot;[CP] Copy</span> Pods Resources&quot;;
			outputPaths = (
			);
			runOnlyForDeploymentPostprocessing = 0;
</pre>
</body>
</html>
